<html layout:decorate="~{layout/layout.html}">

<head>
    <script src="https://cdn.tailwindcss.com/3.1.4"></script>

</head>

<body>

<main layout:fragment="main">

    <!-- 토스페이먼츠 결제창 SDK 추가 -->
    <script src="https://js.tosspayments.com/v1/payment"></script>

    <script th:inline="javascript">
        const orderId = /*[[ ${payment.orderNum} ]]*/ null;
        const customerName = /*[[ ${payment.customerName} ]]*/ null;
        const customerEmail = /*[[ ${payment.customerEmail} ]]*/ null;
        const orderName = /*[[ ${payment.orderName} ]]*/ null;
        const createDate = /*[[ ${payment.createDate} ]]*/ null;
        const paySuccessYn = null;

    </script>

    <script>
            const clientKey = 'test_ck_qLlDJaYngroEyp7RMDx3ezGdRpXx';

            // ------  결제위젯 초기화 ------
            const tossPayments = TossPayments(clientKey); // 회원 결제
            function paymentBasic() {
                tossPayments
                    .requestPayment("카드", {
                        amount: 15000,
                        orderId: "order_" + generateRandomString(),
                        orderName: "Basic 요금제",
                        successUrl: window.location.origin + "/success",
                        failUrl: window.location.origin + "/fail",
                        customerEmail: customerEmail,
                        customerName: customerName,
                        createDate: createDate,
                        paySuccessYn: paySuccessYn,
                    })
                    .catch(handlePaymentError);
            }
            function paymentPremium() {
                tossPayments
                    .requestPayment("카드", {
                        amount: 29000,
                        orderId: "order_" + generateRandomString(),
                        orderName: "Premium 요금제",
                        successUrl:window.location.origin + "/success",
                        failUrl: window.location.origin + "/fail",
                        customerEmail: customerEmail,
                        customerName: customerName,
                        createDate: createDate,
                        paySuccessYn: paySuccessYn,
                    })
                    .catch(handlePaymentError);
            }
            function paymentPro() {
                tossPayments
                    .requestPayment("카드", {
                        amount: 49000,
                        orderId: "order_" + generateRandomString(),
                        orderName: "Pro 요금제",
                        successUrl: window.location.origin + "/success",
                        failUrl: window.location.origin + "/fail",
                        customerEmail: customerEmail,
                        customerName: customerName,
                        createDate: createDate,
                        paySuccessYn: paySuccessYn,
                    })
                    .catch(handlePaymentError);
            }

            function handlePaymentError(error) {
                if (error.code === 'USER_CANCEL') {
                    // 결제 고객이 결제창을 닫았을 때 에러 처리
                } else if (error.code === 'INVALID_CARD_COMPANY') {
                    // 유효하지 않은 카드 코드에 대한 에러 처리
                }
            }
            function generateRandomString() {
            return window.btoa(Math.random()).slice(0, 20);
            }



    </script>

    <div class="h-screen p-10">
        <div class="p-2 max-w-screen-lg  mx-auto grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
            <div class="outline outline-gray-200 rounded-lg overflow-hidden shadow-md bg-white">
                <div class="px-6 py-8">
                    <h3 class="text-3xl font-bold mb-4 text-purple-600">Basic</h3>
                    <p class="text-lg text-gray-600 mb-8">BASIC 요금제 설명</p>
                    <h2 amount="15,000" class="text-5xl font-bold mb-8 text-purple-600">15,000원</h2>
                    <button onclick="paymentBasic();" id="payment-button-basic" orderName="Basic 요금제"
                            sec:authorize="isAnonymous()"
                            class="bg-purple-600 text-white py-2 px-4 rounded-lg text-lg hover:bg-purple-700 transition duration-300 ease-in-out">
                        결제하기
                    </button>
                </div>
            </div>
            <div class="outline outline-gray-200 rounded-lg overflow-hidden shadow-md bg-white">
                <div class="px-6 py-8">
                    <h3 class="text-3xl font-bold mb-4 text-green-600">Premium</h3>
                    <p class="text-lg text-gray-600 mb-8"> PRIMIUM 요금제 설명</p>
                    <h2 amount="29,000" class="text-5xl font-bold mb-8 text-green-600">29,000원</h2>

                    <button onclick="paymentPremium();" id="payment-button-premium" orderName="Premium 요금제"
                            sec:authorize="isAnonymous()"
                            class="bg-green-600 text-white py-2 px-4 rounded-lg text-lg hover:bg-green-700 transition duration-300 ease-in-out">
                        결제하기
                    </button>
                </div>
            </div>
            <div class="outline outline-gray-200 rounded-lg overflow-hidden shadow-md bg-white">
                <div class="px-6 py-8">
                    <h3 class="text-3xl font-bold mb-4 text-yellow-600">Pro</h3>
                    <p class="text-lg text-gray-600 mb-8">PRO 요금제 설명</p>
                    <h2 amount="49,000" class="text-5xl font-bold mb-8 text-yellow-600">49,000원</h2>
                    <button onclick="paymentPro();" id="payment-button-pro" orderName="Pro 요금제"
                            sec:authorize="isAnonymous()"
                            class="bg-yellow-600 text-white py-2 px-4 rounded-lg text-lg hover:bg-yellow-700 transition duration-300 ease-in-out">
                        결제하기
                    </button>
                </div>

            </div>

        </div>

    </div>

</main>
</body>

</html>